<?xml version="1.0" encoding="utf-8"?>
<configuration>

	<!-- Justér kun hvis dit projekt target ikke er 4.7.2 -->
	<startup>
		<supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.7.2" />
	</startup>

	<system.serviceModel>

		<!-- 1) Extensions: gør at WCF forstår LibBasBinding/LibBasBehavior -->
		<extensions>
			<bindingExtensions>
				<add name="LibBasBinding"
					 type="Digst.OioIdws.LibBas.Bindings.LibBasBindingCollectionElement, Digst.OioIdws.LibBas" />
			</bindingExtensions>

			<behaviorExtensions>
				<add name="LibBasBehavior"
					 type="Digst.OioIdws.LibBas.Behaviors.LibBasClientBehaviorExtensionElement, Digst.OioIdws.LibBas" />
			</behaviorExtensions>
		</extensions>

		<!-- 2) Behaviors: her peger vi på dit certifikat -->
		<behaviors>
			<endpointBehaviors>
				<behavior name="LibBasBehaviourConfiguration">
					<clientCredentials>

						<!-- DIT cert (funktionscert) -->
						<clientCertificate
						  findValue="639b5ff8e53246dd448bab496b6bbc2fb5e485fc"
						  x509FindType="FindByThumbprint"
						  storeLocation="CurrentUser"
						  storeName="My" />

					</clientCredentials>

					<LibBasBehavior />
				</behavior>
			</endpointBehaviors>
		</behaviors>

		<!-- 3) Bindings: LibBasBindingConfiguration (skal hedde præcis dette) -->
		<bindings>
			<LibBasBinding>
				<binding name="LibBasBindingConfiguration">
					<!-- Typisk behøver man ikke pille ved dette i første omgang.
               Hvis du får timeout senere, kan vi justere send/receiveTimeout. -->
				</binding>
			</LibBasBinding>
		</bindings>

		<!-- 4) Client endpoint: SF1520 PersonBaseDataExtended v5 -->
		<client>
			<endpoint
			  name="PersonBaseDataExtended_v5"
			  address="https://exttest.serviceplatformen.dk/service/CPR/PersonBaseDataExtended/5"
			  behaviorConfiguration="LibBasBehaviourConfiguration"
			  binding="LibBasBinding"
			  bindingConfiguration="LibBasBindingConfiguration"
			  contract="SF1520.PersonBaseDataExtendedPortType" />
		</client>

		<!-- 5) Diagnostics: behold dem hvis du vil logge SOAP/fejl (kan slås fra senere) -->
		<diagnostics>
			<messageLogging
			  logEntireMessage="true"
			  logMalformedMessages="true"
			  logMessagesAtServiceLevel="true"
			  logMessagesAtTransportLevel="true"
			  maxMessagesToLog="2147483647"
			  maxSizeOfMessageToLog="2147483647" />
		</diagnostics>

	</system.serviceModel>

	<system.diagnostics>
		<sources>
			<source name="System.ServiceModel"
					switchValue="Verbose,ActivityTracing"
					propagateActivity="true">
				<listeners>
					<add name="ServiceModelTraceListener" />
				</listeners>
			</source>

			<source name="System.ServiceModel.MessageLogging">
				<listeners>
					<add name="ServiceModelMessageLoggingListener" />
				</listeners>
			</source>
		</sources>

		<sharedListeners>
			<add name="ServiceModelTraceListener"
				 type="System.Diagnostics.XmlWriterTraceListener, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"
				 initializeData="Tracelog.svclog"
				 traceOutputOptions="Timestamp" />

			<add name="ServiceModelMessageLoggingListener"
				 type="System.Diagnostics.XmlWriterTraceListener, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"
				 initializeData="Messages.svclog"
				 traceOutputOptions="Timestamp" />
		</sharedListeners>

		<trace autoflush="true" />
	</system.diagnostics>

</configuration>
